parameters:
- name: webView
  type: string
  default: "edge-chromium"

steps:
  - task: CmdLine@2
    inputs:
      script: |
        
        echo Setting WebView Type: ${{ parameters.webView }}
        call npx office-addin-dev-settings webview manifest.xml ${{ parameters.webView }}
        call npx office-addin-dev-settings webview test/end-to-end/test-manifest.xml ${{ parameters.webView }}
        
        echo Running Tests
        npm run test:unit -- --reporter mocha-junit-reporter
        npm run test:e2e -- --reporter mocha-junit-reporter
            
        echo Done running tests
    displayName: 'Run Tests'

  - task: PublishTestResults@2
    condition: succeededOrFailed()
    inputs:
      testRunner: JUnit
      testResultsFiles: '**/test-results.xml'

  - task: PublishPipelineArtifact@1
    condition: failed()
    inputs:
      targetPath: $(System.DefaultWorkingDirectory)/screen.jpg
      artifactName: Screenshot

  - task: DownloadPipelineArtifact@2
    inputs:
      artifact: Screenshot
